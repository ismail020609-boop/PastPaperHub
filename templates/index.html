<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; }
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        /* The Fading Animation for Logo 1 */
        @keyframes fade-pulse {
            0% { opacity: 0.2; transform: scale(0.98); }
            50% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 0.2; transform: scale(0.98); }
        }
        .animate-fade {
            animation: fade-pulse 3s infinite ease-in-out;
        }

        /* Video Container Styling */
        .video-background-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
            overflow: hidden;
        }

        .bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Adjust transparency here */
            z-index: -1;
        }
    </style>
    <meta charset="UTF-8">
    <title>Past Paper Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
        (function() {
            if (localStorage.theme === 'dark' || (!localStorage.theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();

        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
        }

        const quotes = [
            { text: "Education is not the learning of facts, but the training of the mind to think.", author: "Albert Einstein" },
            { text: "Knowledge is power.", author: "Francis Bacon" }
        ];

        function displayRandomQuote() {
            const randomIndex = Math.floor(Math.random() * quotes.length);
            const selectedQuote = quotes[randomIndex];
            document.getElementById('quote-text').innerText = `"${selectedQuote.text}"`;
            document.getElementById('quote-author').innerText = `— ${selectedQuote.author}`;
        }

        window.onload = function() {
            displayRandomQuote();
        };
    </script>
</head>
<body class="bg-gray-100 dark:bg-[#030303] text-gray-900 dark:text-[#D7DADC] min-h-screen flex flex-col transition-colors">

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <script>alert("{{ messages[0] }}");</script>
      {% endif %}
    {% endwith %}

    <nav class="sticky top-0 z-50 bg-white dark:bg-[#1A1A1B] border-b dark:border-[#343536] px-6 py-2 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-6">
            <div class="flex flex-col cursor-pointer" onclick="location.href='/'">
                <h1 class="font-black text-lg text-blue-500 leading-none uppercase tracking-tighter">Past Paper Hub</h1>
                <div class="flex gap-3 text-[9px] font-bold opacity-50 uppercase mt-1">
                    <span class="text-green-500">● <span id="online-count">{{ online_users }}</span> Online</span>
                    <span>Posts: {{ total_posts }}</span>
                </div>
            </div>
            <img src="{{ url_for('static', filename='logo.png') }}" class="w-10 h-10 object-contain">
        </div>

        <div class="flex items-center gap-4">
            <a href="/about" class="text-[10px] font-bold uppercase opacity-60 hover:opacity-100 transition-all mr-2">About</a>
            <a href="/create-thread" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1.5 rounded-full text-[10px] font-bold uppercase shadow-md transition-all">Create Thread</a>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                <i class="fas fa-adjust text-sm"></i>
            </button>
            {% if session['user'] %}
                <div class="flex flex-col items-end border-l dark:border-[#343536] pl-4">
                    <span class="text-[10px] font-bold">u/{{ session['user'] }}</span>
                    <a href="/logout" class="text-[9px] text-red-500 font-bold uppercase hover:underline">Logout</a>
                </div>
            {% endif %}
        </div>
    </nav>

    <div class="bg-white dark:bg-[#1A1A1B] border-b dark:border-[#343536] py-12 shadow-sm z-10">
        <div class="max-w-6xl mx-auto px-6 text-center space-y-6 flex flex-col items-center">
            <div class="flex justify-center mb-2">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo 1" class="w-24 h-24 object-contain animate-fade">
            </div>
            <div class="space-y-2">
                <h2 class="text-3xl md:text-5xl font-black tracking-tighter uppercase text-gray-800 dark:text-white mb-2">Past Paper Hub</h2>
                <h3 id="quote-text" class="text-xl md:text-2xl font-light italic opacity-80 text-gray-800 dark:text-white">"Loading inspiration..."</h3>
                <p id="quote-author" class="text-xs font-black text-blue-500 uppercase tracking-[0.3em]"></p>
            </div>
            <div class="pt-6 flex w-full max-w-2xl mx-auto">
                <form action="/" method="GET" class="flex w-full group shadow-xl rounded-lg overflow-hidden">
                    <input type="text" name="search" placeholder="Search subject code or name..." value="{{ request.args.get('search', '') }}"
                           class="flex-1 border-none dark:bg-black px-6 py-4 outline-none focus:ring-2 focus:ring-blue-500 transition-all text-sm font-medium">
                    <button class="bg-blue-500 text-white px-10 py-4 text-xs font-black uppercase hover:bg-blue-600 transition-colors tracking-widest">
                        <i class="fas fa-search mr-2"></i> Search
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="video-background-container">
        <video autoplay muted loop playsinline class="bg-video">
            <source src="{{ url_for('static', filename='your_video_name.mp4') }}" type="video/mp4">
        </video>
        <div class="video-overlay"></div>

        <main class="relative z-10 max-w-6xl mx-auto mt-10 px-4 grid grid-cols-12 gap-8 pb-10 w-full">
            <aside class="col-span-12 md:col-span-3">
                <div class="bg-white/90 dark:bg-[#1A1A1B]/90 backdrop-blur-sm rounded-xl border dark:border-[#343536] overflow-hidden shadow-sm sticky top-20">
                    <div class="p-4 border-b dark:border-[#343536] font-bold text-xs uppercase opacity-50 tracking-widest">Faculties</div>
                    <div class="flex flex-col">
                        <a href="/" class="flex items-center gap-3 px-4 py-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 border-b dark:border-[#343536] transition">
                            <i class="fas fa-globe text-[10px]"></i> All Threads
                        </a>
                        <a href="/?faculty=DMLT" class="flex items-center gap-3 px-4 py-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 border-b dark:border-[#343536] transition">
                            <i class="fas fa-microscope text-[10px]"></i> DMLT
                        </a>
                    </div>
                </div>
            </aside>

            <div class="col-span-12 md:col-span-9">
                <h3 class="text-xs font-bold uppercase text-white/60 mb-4 tracking-widest">
                    Recent Discussions
                </h3>
                
                {% for t in threads %}
                <div class="bg-white/95 dark:bg-[#1A1A1B]/95 backdrop-blur-sm rounded-xl border dark:border-[#343536] flex mb-4 overflow-hidden shadow-sm hover:border-blue-500 transition cursor-pointer group" onclick="location.href='/thread/{{t.id}}'">
                    <div class="w-12 bg-gray-50/50 dark:bg-[#151516]/50 flex flex-col items-center py-4 gap-1 border-r dark:border-[#343536]" onclick="event.stopPropagation()">
                        <i class="fas fa-arrow-up text-lg opacity-30"></i>
                        <span class="text-xs font-black">{{ t.votes|length }}</span>
                    </div>

                    <div class="p-4 flex-1">
                        <div class="text-[10px] font-bold opacity-40 uppercase tracking-wide">
                            <span class="text-blue-500">{{ t.faculty }}</span> • u/{{ t.author }} • {{ t.date_posted.strftime('%b %d, %Y') }}
                        </div>
                        <h2 class="text-lg font-bold mt-1 text-gray-800 dark:text-gray-100 flex items-center gap-2">
                            <span class="text-blue-500">[{{ t.subject_code }}]</span> {{ t.subject_name }}
                        </h2>
                        <p class="text-sm opacity-60 mt-1 line-clamp-2 leading-relaxed">{{ t.content }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <footer class="bg-white dark:bg-[#1A1A1B] border-t dark:border-[#343536] py-8 z-10">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <img src="{{ url_for('static', filename='logo2.png') }}" class="w-10 h-10 object-contain">
                <div class="flex flex-col">
                    <h2 class="font-black text-sm text-blue-500 uppercase tracking-tighter">Mael's Blueprint</h2>
                    <p class="text-[9px] font-bold opacity-50 uppercase">© 2025 All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const socket = io();
        socket.on('user_count', (count) => {
            const el = document.getElementById('online-count');
            if(el) el.innerText = count;
        });
    </script>
</body>
</html>